<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>How far?</title>
 <script src="javascripts/jquery-2.1.1.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?v=3.exp"></script>
	<script type="text/javascript">
		$(function(){
			if(localStorage.length > 0){
				for (i = 0; i < localStorage.length; i++) {
					var itemKey = localStorage.key(i);
					if (itemKey.indexOf("Panorama") > -1){
						var value = localStorage.getItem(itemKey);
						$('#favPanoramaList').append(
							$('<option></option>').val(value).html(itemKey)
						);
					}
				}

			}
			if ($('#favPanoramaList').children('option').length <= 1){
				$("#noPansSection").show();
			}
			var sv;
			var panorama;
			var coords;
			
			$('#favPanoramaList').change(function(){
				var coordString = $('#favPanoramaList').val();
				if (coordString !== ""){
					var coordsArray = coordString.split(",");
					var lat = coordsArray[0];
					var lon = coordsArray[1];
					 coords = new google.maps.LatLng(lat, lon);
						 sv = new google.maps.StreetViewService();
						 $("#gameSection").show();
						sv.getPanoramaByLocation(coords, 60000, processSVData);
				}
			});
			
	function processSVData(data, status) {
		if (panorama != null){
				panorama.setVisible(false);
		}
	  if (status == google.maps.StreetViewStatus.OK) {
	   var panoramaOptions = {
		position: coords,
		addressControl: false,
		linksControl: false,
		panControl: false,
		zoomControlOptions: {
		  style: google.maps.ZoomControlStyle.SMALL
		},
		enableCloseButton: false,
		pov: {
				  heading: 270,
					pitch: 0
		  }
	  };
	  	  panorama = new google.maps.StreetViewPanorama(document.getElementById('pano'), panoramaOptions);
		panorama.setPano(data.location.pano);
		panorama.setVisible(true);


	  } else {
	  }
	}

		$("#mainTitle").hover( function(){
				$("#logo").attr('class', "spin");	
			},
			function(){
				$("#logo").attr('class', "");		
			});
	});
	</script>
	<link rel="stylesheet" type="text/css" href="styles/site.css">
  </head>
  <body>
	<header class="mainHeader">
		<a href="/">
			<h1 id="mainTitle">			
				How far
				<svg height="90" width="90" id="logo">
				  <circle cx="45" cy="45" r="42" stroke="red" stroke-width="3" fill="red"></circle>  
				  <text x="30" y="65" fill="white" font-size="70px">?</text>
				  SVG not supported.
				</svg>
			</h1>
		</a>
		<h3>Know your place.</h3>
	</header>
	<section class="navSect">
		<nav>
			<a href="/">Home</a> |
			<a href="/favourites.html">Favourites</a> 
		</nav>
	</section>
	<article id="game">
		<header class="gameHeader">
			<h2>Your favourite panoramas</h2>
		</header>
		<section id="noPansSection" style="width:100%;display:none">
			<p class="noPansText">You have no panoramas favourited! Add them by playing the game and clicking the heart button.</p>
		</section>
		<section id="gameSection" style="height:60%; width:100%;display:none">
			<div id="pano" style="width:100%;height:100%;float:left"></div>
		</section>
		<section id="answerSection"  class="textSection">
			<label for="favPanoramaList" id="favPanLabel">Pick a panorama from your favourites:</label>
			<select id="favPanoramaList">
				<option value="">Select a panorama</option>
			</select>
		</section>
	</article>
  </body>
</html>